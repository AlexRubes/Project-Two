<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="./css/reset.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" media="screen" title="no title">
    <style>
        /* Set the size of the div element that contains the map */
        #map {
          height: 100vh;  /* The height is 100 view height */
          width: 100%;  /* The width is the 100% width of the web page */
        }
    </style>
  </head>
  <body>
    <!-- Bootstrap container for our layout. -->
    <div class="container-fluid p-0">
      <div class="bg-info row">
        <div class="col">
            <h3 class="display-1 text-center">TRI Facilities in Illinois</h3>
            <p class="text-center">Orange circles represent TRI facilities. <br>Click on the circle to get more information about that facility.</p>
        </div>
      </div>
      
      <!--The div element for the map -->
      <div class="" id="map"></div>
    </div>
    
    <script>

    // The callback function in the GMaps API call. This grabs the above div with an id of map and renders the map.
    function initMap() {
      // This is the map, which takes in an object with ALL of our styling objects in the styles key.
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
      center: {lat: 41.8781, lng: -87.6298},
      styles: [
    {
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#1d2c4d"
        }
      ]
    },
    {
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#8ec3b9"
        }
      ]
    },
    {
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#1a3646"
        }
      ]
    },
    {
      "featureType": "administrative.country",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#4b6878"
        }
      ]
    },
    {
      "featureType": "administrative.land_parcel",
      "elementType": "labels",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "administrative.land_parcel",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#64779e"
        }
      ]
    },
    {
      "featureType": "administrative.province",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#4b6878"
        }
      ]
    },
    {
      "featureType": "landscape.man_made",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#334e87"
        }
      ]
    },
    {
      "featureType": "landscape.natural",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#023e58"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#283d6a"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "labels.text",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#6f9ba5"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#1d2c4d"
        }
      ]
    },
    {
      "featureType": "poi.attraction",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.business",
      "elementType": "labels",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.business",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
        {
          "color": "#023e58"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "simplified"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#3C7680"
        }
      ]
    },
    {
      "featureType": "poi.place_of_worship",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.school",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#304a7d"
        }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#98a5be"
        }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#1d2c4d"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#2c6675"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#255763"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#b0d5ce"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#023e58"
        }
      ]
    },
    {
      "featureType": "road.local",
      "elementType": "labels",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "transit",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#98a5be"
        }
      ]
    },
    {
      "featureType": "transit",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#1d2c4d"
        }
      ]
    },
    {
      "featureType": "transit.line",
      "elementType": "geometry.fill",
      "stylers": [
        {
          "color": "#283d6a"
        }
      ]
    },
    {
      "featureType": "transit.station",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#3a4762"
        }
      ]
    },
    {
      "featureType": "transit.station",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "water",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#0e1626"
        }
      ]
    },
    {
      "featureType": "water",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#4e6d70"
        }
      ]
    }
  ]
    });
    // This actually calls our setMarkers function below.
    setMarkers(map);
  }

  // This is the array that will store all of our facilities that our API brings back.
  var facilities = [];
  
  function setMarkers(map) {
      // Adds markers to the map.
      // Marker sizes are expressed as a Size of X,Y where the origin of the image
      // (0,0) is located in the top left of the image.
      // Origins, anchor positions and coordinates of the marker increase in the X
      // direction to the right and in the Y direction down.

    // This is our SVG for the orange plumes for facilities on the map.
    var image = {
      path: "M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",
      fillColor: '#FF7b00',
      fillOpacity: .9,
      anchor: new google.maps.Point(0,0),
      strokeWeight: 0,
      scale: 1
    };

    // Shapes define the clickable region of the icon. The type defines an HTML
    // <area> element 'poly' which traces out a polygon as a series of X,Y points.
    // The final coordinate closes the poly by connecting to the first coordinate.
    var shape = {
      coords: [1, 1, 1, 20, 18, 20, 18, 1],
      type: 'poly'
    };

    // This is our actual jQuery $get API call to our database. This does all the heavy-lifting.
    $.get("/api/all", function(data) {

      for (var i = 0; i < data.length; i++) {
        // var facility = facilities[i];
        var fac_name = data[i].FACILITY_NAME;
        var fac_lat = parseFloat(data[i].LATITUDE);
        var fac_lon = parseFloat(data[i].LONGITUDE);

        console.log("Facilities Name: ", fac_name);
        console.log("Facilities Latitude: ", fac_lat);
        console.log("Facilities Longitude: ", fac_lon);
        var new_facility = [];
        new_facility.push(fac_name, fac_lat, fac_lon);
        console.log("New Facility: " + new_facility);
        facilities.push(new_facility);
        console.log("Facilities now is: " + facilities);

        var cityCircle = new google.maps.Circle({
            strokeColor: '#FF7b00',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF7b00',
            fillOpacity: 0.35,
            map: map,
            center: {lat: fac_lat, lng: fac_lon},
            title: fac_name,
            radius: 100
          });

        // var marker = new google.maps.Marker({
        //   position: {lat: fac_lat, lng: fac_lon},
        //   map: map,
        //   icon: cityCircle,
        //   shape: shape,
        //   title: fac_name,
        //   // zIndex: facility[3]
        // });
    }

    });

}
    </script>
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter contains our API key
    * The callback parameter executes the initMap() function
    -->

    <!-- Link to our javascript file -->
    <script src="js/main.js" type="text/javascript"></script>
    <!-- The Google Maps API call with our API Key and the callback function, initMap. -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbkAtce3FywDMsrsIBlY5IoBxfobNPqtw&callback=initMap">
    </script>
    
  </body>
</html>